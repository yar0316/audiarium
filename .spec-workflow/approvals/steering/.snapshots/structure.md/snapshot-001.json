{
  "id": "snapshot_1764684363654_kusb0gmwg",
  "approvalId": "approval_1764684363603_kaek6rbny",
  "approvalTitle": "Project Structure - ディレクトリ構成・命名規約・コードパターン",
  "version": 1,
  "timestamp": "2025-12-02T14:06:03.654Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Project Structure\r\n\r\n## Directory Organization\r\n\r\n```\r\naudiarium/                      # プロジェクトルート（モノレポ）\r\n├── .spec-workflow/             # 仕様書・ワークフロー管理\r\n│   ├── steering/               # ステアリングドキュメント\r\n│   ├── specs/                  # 機能仕様書\r\n│   └── templates/              # テンプレート\r\n├── web/                        # Next.js（Web UI + API）\r\n│   ├── src/\r\n│   │   ├── app/                # App Router（ページ・API）\r\n│   │   │   ├── api/            # API Routes\r\n│   │   │   │   ├── tracks/     # 楽曲 API\r\n│   │   │   │   ├── playlists/  # プレイリスト API\r\n│   │   │   │   └── auth/       # 認証 API\r\n│   │   │   ├── (auth)/         # 認証関連ページ\r\n│   │   │   ├── tracks/         # 楽曲ページ\r\n│   │   │   ├── playlists/      # プレイリストページ\r\n│   │   │   ├── layout.tsx      # ルートレイアウト\r\n│   │   │   └── page.tsx        # ホームページ\r\n│   │   ├── components/         # 再利用可能コンポーネント\r\n│   │   │   ├── ui/             # 基本 UI コンポーネント\r\n│   │   │   ├── features/       # 機能別コンポーネント\r\n│   │   │   └── layouts/        # レイアウトコンポーネント\r\n│   │   ├── lib/                # ユーティリティ・設定\r\n│   │   │   ├── supabase/       # Supabase クライアント\r\n│   │   │   ├── audio/          # 音声再生ユーティリティ\r\n│   │   │   └── utils/          # 汎用ユーティリティ\r\n│   │   ├── hooks/              # カスタムフック\r\n│   │   ├── types/              # TypeScript 型定義\r\n│   │   └── server/             # サーバーサイドロジック\r\n│   │       ├── services/       # ビジネスロジック\r\n│   │       └── repositories/   # データアクセス層\r\n│   ├── public/                 # 静的ファイル\r\n│   └── package.json\r\n└── app/                        # Flutter（モバイル）※後日作成\r\n    ├── lib/\r\n    │   ├── screens/            # 画面\r\n    │   ├── widgets/            # ウィジェット\r\n    │   ├── services/           # API クライアント\r\n    │   ├── models/             # データモデル\r\n    │   └── providers/          # 状態管理\r\n    └── pubspec.yaml\r\n```\r\n\r\n## Naming Conventions\r\n\r\n### Files\r\n\r\n- **コンポーネント**: `kebab-case.tsx`（例: `track-list.tsx`）\r\n- **ページ**: `page.tsx`（Next.js App Router 規約）\r\n- **API**: `route.ts`（Next.js App Router 規約）\r\n- **ユーティリティ**: `kebab-case.ts`（例: `format-duration.ts`）\r\n- **型定義**: `kebab-case.ts`（例: `track.ts`）\r\n- **テスト**: `*.test.ts` / `*.test.tsx`\r\n\r\n### Code\r\n\r\n- **コンポーネント**: `PascalCase`（例: `TrackList`）\r\n- **関数**: `camelCase`（例: `formatDuration`）\r\n- **定数**: `UPPER_SNAKE_CASE`（例: `MAX_FILE_SIZE`）\r\n- **変数**: `camelCase`（例: `trackList`）\r\n- **型・インターフェース**: `PascalCase`（例: `Track`, `PlaylistWithTracks`）\r\n\r\n### Directories\r\n\r\n- すべて `kebab-case`（例: `track-list/`, `api/`）\r\n- Next.js 規約のフォルダは例外（例: `(auth)/`, `[id]/`）\r\n\r\n## Import Patterns\r\n\r\n### Import Order\r\n\r\n```typescript\r\n// 1. React / Next.js\r\nimport { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\n\r\n// 2. 外部ライブラリ\r\nimport { createClient } from '@supabase/supabase-js';\r\n\r\n// 3. 内部モジュール（エイリアス使用）\r\nimport { TrackService } from '@/server/services/track-service';\r\nimport { Track } from '@/types/track';\r\n\r\n// 4. 相対インポート（同一機能内のみ）\r\nimport { TrackItem } from './track-item';\r\n\r\n// 5. スタイル\r\nimport './styles.css';\r\n```\r\n\r\n### Path Aliases\r\n\r\n```typescript\r\n// tsconfig.json で設定済み\r\n\"@/*\" → \"src/*\"\r\n\r\n// 使用例\r\nimport { cn } from '@/lib/utils';\r\nimport { Button } from '@/components/ui/button';\r\n```\r\n\r\n## Code Structure Patterns\r\n\r\n### コンポーネントファイル構成\r\n\r\n```typescript\r\n// 1. インポート\r\nimport { useState } from 'react';\r\n\r\n// 2. 型定義\r\ninterface TrackListProps {\r\n  tracks: Track[];\r\n  onSelect: (track: Track) => void;\r\n}\r\n\r\n// 3. コンポーネント本体\r\nexport function TrackList({ tracks, onSelect }: TrackListProps) {\r\n  // hooks\r\n  const [selected, setSelected] = useState<string | null>(null);\r\n\r\n  // handlers\r\n  const handleClick = (track: Track) => {\r\n    setSelected(track.id);\r\n    onSelect(track);\r\n  };\r\n\r\n  // render\r\n  return (\r\n    <ul>\r\n      {tracks.map((track) => (\r\n        <li key={track.id} onClick={() => handleClick(track)}>\r\n          {track.title}\r\n        </li>\r\n      ))}\r\n    </ul>\r\n  );\r\n}\r\n```\r\n\r\n### API Route 構成\r\n\r\n```typescript\r\n// src/app/api/tracks/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { TrackService } from '@/server/services/track-service';\r\n\r\n// GET /api/tracks\r\nexport async function GET(request: NextRequest) {\r\n  const tracks = await TrackService.findAll();\r\n  return NextResponse.json(tracks);\r\n}\r\n\r\n// POST /api/tracks\r\nexport async function POST(request: NextRequest) {\r\n  const body = await request.json();\r\n  const track = await TrackService.create(body);\r\n  return NextResponse.json(track, { status: 201 });\r\n}\r\n```\r\n\r\n### Service 層構成\r\n\r\n```typescript\r\n// src/server/services/track-service.ts\r\nimport { supabase } from '@/lib/supabase/client';\r\nimport { Track, CreateTrackInput } from '@/types/track';\r\n\r\nexport const TrackService = {\r\n  async findAll(): Promise<Track[]> {\r\n    const { data, error } = await supabase\r\n      .from('tracks')\r\n      .select('*')\r\n      .order('created_at', { ascending: false });\r\n\r\n    if (error) throw error;\r\n    return data;\r\n  },\r\n\r\n  async create(input: CreateTrackInput): Promise<Track> {\r\n    const { data, error } = await supabase\r\n      .from('tracks')\r\n      .insert(input)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return data;\r\n  },\r\n};\r\n```\r\n\r\n## Code Organization Principles\r\n\r\n1. **Single Responsibility**: 1ファイル1責務\r\n2. **Colocation**: 関連ファイルは近くに配置（テスト、型定義）\r\n3. **Feature-first**: 機能単位でグルーピング\r\n4. **Barrel exports 非推奨**: 循環参照を避けるため直接インポート\r\n\r\n## Module Boundaries\r\n\r\n```\r\n┌─────────────────────────────────────────────────────────┐\r\n│                      app/ (Pages)                       │\r\n│                          ↓                              │\r\n│                   components/                           │\r\n│                      ↓    ↓                             │\r\n│               hooks/       lib/                         │\r\n│                  ↓          ↓                           │\r\n│            ┌─────┴──────────┴─────┐                     │\r\n│            │     server/          │ ← API Routes only   │\r\n│            │  services/repos      │                     │\r\n│            └──────────┬───────────┘                     │\r\n│                       ↓                                 │\r\n│                   Supabase                              │\r\n└─────────────────────────────────────────────────────────┘\r\n\r\n依存方向: 上 → 下（逆方向の依存は禁止）\r\n```\r\n\r\n## Code Size Guidelines\r\n\r\n- **ファイル**: 300行以下を目安\r\n- **関数/メソッド**: 50行以下を目安\r\n- **コンポーネント**: props 10個以下、分割を検討\r\n- **ネスト深度**: 最大3レベル\r\n\r\n## Documentation Standards\r\n\r\n- **公開関数**: JSDoc コメント必須\r\n- **複雑なロジック**: インラインコメント追加\r\n- **型定義**: 必要に応じてコメント追加\r\n- **README**: 各主要ディレクトリに配置（必要に応じて）\r\n",
  "fileStats": {
    "size": 8556,
    "lines": 237,
    "lastModified": "2025-12-02T14:05:47.301Z"
  },
  "comments": []
}